# Cursor AI Instructions - Secure PII Management System Challenge

> **Language**: All content in this file MUST be in English. Keep all instructions, comments, and documentation in English for consistency.

> **IMPORTANT**: DO NOT make commits unless explicitly requested by the user. Only stage files or prepare changes, but wait for user confirmation before committing.

## Project Context

This is a **take-home engineering challenge** for a job application. The goal is to build a secure PII management system with:

- **Rails application** (Ruby on Rails 8): Web interface for collecting and displaying PII data
- **Java microservice** (Java 17 + Spring Boot 3.2): SSN validation service per SSA standards

**Working Methodology**: Small, focused PRs - each implementing a single feature with tests.

---

## Critical Requirements to Remember

### SSN Validation Rules (Java Service)
The Java microservice must validate SSN per SSA standards:
- Format: XXX-XX-XXXX (9 digits with dashes)
- Area number (first 3 digits):
  - Cannot be 000 or 666
  - 900-999 IS VALID (used for ITINs)
- Group number (middle 2 digits): Cannot be 00
- Serial number (last 4 digits): Cannot be 0000
- Must reject known invalid test SSNs:
  - 078-05-1120 (Social Security Administration's public example)
  - 219-09-9999 (known invalid)
  - 457-55-5462 (known invalid)

### Security Implementation
- **At Rest**: SSN encrypted in PostgreSQL using Rails encrypted attributes
- **In Transit**: Document HTTPS/TLS (not required for local dev)
- **Display**: SSN masked as `***-**-1234` (only last 4 digits visible)
- **Important**: Masking happens in Rails presentation layer, NOT in Java service
- Java service is internal service-to-service, not exposed to end users

### Architecture
- **Monorepo structure**:
  - `/rails-app` - Rails application
  - `/java-service` - Java Spring Boot microservice
- Services communicate via HTTP REST
- Docker Compose orchestrates all services
- PostgreSQL database

### PII Form Fields
Rails form must collect:
- First Name (required, 1-50 chars)
- Middle Name (required, 1-50 chars)
- Middle Name Override (checkbox for users without middle name)
- Last Name (required, 1-50 chars)
- Social Security Number (required, XXX-XX-XXXX format)
- Address:
  - Street Address 1 (required)
  - Street Address 2 (optional)
  - City (required)
  - State (required, 2-letter abbreviation)
  - ZIP Code (required, 5 digits)

### Testing Requirements
- **Rails**: RSpec with >70% code coverage
  - Model validations
  - Controller/request specs
  - Integration tests for Java service communication
  - Test encryption/decryption
- **Java**: JUnit 5 with >70% code coverage
  - Unit tests for SSN validation logic
  - API endpoint tests

---

## Development Guidelines

### When Writing Code
1. **Test First**: Every feature needs tests
2. **Single Responsibility**: One PR = One feature
3. **Security First**: Always encrypt PII, validate inputs
4. **Documentation**: Update README/ARCHITECTURE.md when needed

### Code Style
- **Rails**: Follow standard Rails conventions, use RSpec for tests
- **Java**: Spring Boot best practices, JUnit 5 for tests
- **Keep it simple**: Functional over beautiful UI
- **No React**: Use Rails views (ERB) with Tailwind CSS
- **No section comments**: Do NOT add comments like `# Validations`, `# Associations`, etc. Code should be self-documenting

### Testing Strategy
- Write tests BEFORE or ALONGSIDE implementation
- Test both happy paths and error cases
- Integration tests for service-to-service communication
- Mock external service calls when appropriate
- **One expectation per test**: Each `it` block MUST have only ONE `expect` statement. Split into multiple tests if needed

### Common Patterns
- Rails calls Java service for SSN validation before saving
- Java service returns validation result (true/false + error message if invalid)
- Rails encrypts SSN before storing in database
- Display layer masks SSN when rendering views

---

## PR/Branch Workflow

### âœ… CHECKLIST for Every PR/Branch

Before completing any PR, ensure you have:

#### 1. **Tests/Specs** (MANDATORY)
- [ ] Written RSpec tests for Rails features (models, controllers, services)
- [ ] Written JUnit tests for Java features
- [ ] Verified tests pass: `bundle exec rspec` or `mvn test`
- [ ] Coverage meets >70% threshold
- [ ] Tests include both happy paths AND error cases

#### 2. **Documentation Updates** (AS NEEDED)
Check if these files need updates:

- [ ] **README.md** - Update if:
  - New feature affects setup/installation
  - New environment variables added
  - New commands or endpoints created
  - Project status/progress changes
  - Implementation status checklist needs updating

- [ ] **ARCHITECTURE.md** - Update if:
  - New service or component added
  - Communication pattern changes
  - Database schema modified
  - Security implementation changes

- [ ] **.cursorrules** - Update if:
  - New patterns or conventions established
  - Project checklist items completed
  - New guidelines or rules needed

- [ ] **CHALLENGE.md** - âš ï¸ Never modify (original requirements)

- [ ] **Code comments** - Add for:
  - Complex business logic
  - Security-critical sections
  - Non-obvious design decisions

#### 3. **Code Quality**
- [ ] No linter errors introduced
- [ ] Follow Rails/Java conventions
- [ ] Secure handling of PII data
- [ ] No hardcoded secrets or credentials

#### 4. **Commit Message**
- [ ] Clear, descriptive message
- [ ] Follows pattern: "Add/Update/Fix [feature/component]"

### ðŸš« Common Mistakes to Avoid

1. **Forgetting tests** - Every PR must have tests
2. **Not updating README** - If feature is user-facing, document it
3. **Incomplete implementation** - Finish what you start in a PR
4. **Multiple features in one PR** - Keep PRs focused and small
5. **Not updating the checklist** - Mark items as complete in `.cursorrules`

---

## Deliverables Checklist

- [ ] Rails app with PII collection form
- [ ] Java microservice with SSN validation
- [ ] PostgreSQL with encrypted SSN storage
- [ ] Display page with masked SSNs
- [ ] Docker Compose setup
- [ ] Tests with >70% coverage (both services)
- [ ] README.md with setup instructions
- [ ] ARCHITECTURE.md with design decisions

---

## Important Notes

- **AI Usage**: Document use of AI tools (this is encouraged!)
- **Assumptions**: Document all assumptions in README.md
- **Quality over Quantity**: Working, well-tested core features > broken complete implementation
- **Time Tracking**: Keep track of time spent for self-assessment

---

## Current Project Status

Check git history for completed PRs. Each PR should be focused and include:
1. Implementation
2. Tests
3. Documentation updates (if needed)

When suggesting new features, consider what's already been implemented in previous PRs.

---

## ðŸ“Š DETAILED PROJECT CHECKLIST

### âœ… COMPLETED (11 PRs)

#### Infrastructure & Setup
- [x] PR #1 - Initial repository setup (README, .gitignore, folder structure)
- [x] PR #2 - Java Spring Boot project structure (pom.xml, application setup)
- [x] PR #5 - Copilot instructions (documentation for AI)
- [x] PR #9 - Dockerfile for Java service
- [x] PR #10 - Rails 8 application with RSpec setup
- [x] PR #11 - Challenge instructions (README + .cursorrules)

#### Java Microservice - SSN Validation
- [x] PR #3 - SSN validation DTOs (SsnValidationRequest, SsnValidationResponse)
- [x] PR #4 - SSN validation service with SSA rules
- [x] PR #6 - Unit tests for SSN validation (>70% coverage)
- [x] PR #7 - SSN validation controller (REST endpoint)
- [x] PR #8 - Health check endpoint with tests

**Java Service Status**: âœ… COMPLETE with >70% test coverage

---

### âœ… COMPLETED - Rails Application & Integration (100%)

#### 1. Database & Models (Rails) âœ…
- [x] Configure PostgreSQL in Rails
- [x] Create Person model with all fields:
  - first_name, middle_name, last_name
  - ssn (encrypted with ActiveRecord::Encryption)
  - street_address_1, street_address_2
  - city, state, zip_code
- [x] Configure SSN encryption (Rails encrypted attributes)
- [x] Migrations with indexes and constraints
- [x] Model validations in Rails (presence, format, length, custom SSN validation)
- [x] Model tests (RSpec) - 100% coverage

#### 2. PII Collection Form (Rails Views) âœ…
- [x] PeopleController with CRUD operations
- [x] new.html.erb view with form including:
  - First Name, Middle Name, Last Name
  - Middle Name Override (checkbox)
  - SSN (format XXX-XX-XXXX with auto-formatting)
  - Address fields (street 1, street 2, city, state, ZIP)
- [x] Styling with Tailwind CSS
- [x] Client-side validations (HTML5 + Stimulus controllers)
- [x] Controller tests (RSpec request specs) - 100% coverage
- [x] Responsive design (mobile + desktop)

#### 3. Integration Rails â†” Java âœ…
- [x] HTTP client service in Rails (SsnValidationService)
- [x] Controller integration: validate SSN before saving
- [x] Error handling when Java service doesn't respond
- [x] Integration tests (mock Java service responses with WebMock)
- [x] Environment variable for Java service URL (.env support)

#### 4. Display Page (Rails Views) âœ…
- [x] index.html.erb view with records table
- [x] show.html.erb view to display individual record
- [x] SSN masking in presenters (***-**-1234)
- [x] Complete routing (routes.rb with RESTful resources)
- [x] Request specs for all views - 100% coverage
- [x] Responsive design with mobile cards

#### 5. Docker Compose & Infrastructure âœ…
- [x] docker-compose.yml with:
  - PostgreSQL service
  - Java service
  - Rails service
  - Network configuration (private pii-network)
- [x] Health checks in docker-compose for all services
- [x] .env.example with required environment variables
- [x] Volumes for data persistence (postgres_data, bundle_cache)
- [x] Custom entrypoint script for Rails
- [x] Proper service dependencies

#### 6. Documentation âœ…
- [x] ARCHITECTURE.md with:
  - Architecture diagram (ASCII art)
  - Rails â†” Java communication flow
  - Database schema
  - Security design decisions
  - Technology choices and rationale
  - 595 lines of detailed technical documentation
- [x] README.md with:
  - Quick start with Docker Compose
  - Local setup instructions
  - How to run tests
  - Environment variables
  - Assumptions and trade-offs
  - CI/CD badges and documentation
- [x] CHALLENGE.md (original requirements preserved)
- [x] .cursorrules (AI coding guidelines)

#### 7. Testing & Coverage âœ…
- [x] ðŸ’¯ **100% coverage in Rails (SimpleCov)** - exceeds requirement by 30%
- [x] Encryption/decryption tests
- [x] SSN masking tests (including edge cases)
- [x] ViewComponent tests with Capybara
- [x] Presenter tests
- [x] Service integration tests
- [x] 81 RSpec examples, 0 failures

---

### ðŸŽ¯ BONUS Features

#### âœ… Completed Bonus Features
- [x] **CI/CD pipeline (GitHub Actions)** - 3 workflows:
  - Rails tests with coverage enforcement
  - Java tests with JaCoCo reporting
  - General CI checks (Docker, security, docs)
- [x] **Hotwire/Turbo for UI updates** - SPA-like navigation with Turbo Frames
- [x] **ViewComponents** - Reusable UI components (ButtonComponent, PersonCardComponent, EmptyStateComponent, FormFieldComponent)
- [x] **Presenter Pattern** - Clean separation of presentation logic (BasePresenter, PersonPresenter)
- [x] **Stimulus Controllers** - Interactive UI (SSN auto-formatting, form validation, flash messages, mobile menu)
- [x] **Responsive Design** - Mobile-first with Tailwind CSS
- [x] **100% Test Coverage** - Exceeds 70% requirement by 30%

#### ðŸš§ Pending Bonus Features (Optional)
- [ ] Edit/Delete functionality for records
- [ ] Advanced input sanitization
- [ ] Audit logging for PII access
- [ ] API rate limiting in Java service

---

## ðŸ“ˆ General Progress

**Completed**: ðŸ’¯ **100% of Core Requirements + Bonus Features**

### Core Requirements âœ…
- âœ… Java microservice (100%)
- âœ… Rails application (100%)
- âœ… Rails-Java integration (100%)
- âœ… Docker Compose (100%)
- âœ… Documentation (100%)
- âœ… Testing & Coverage (100% - exceeds 70%)

### Bonus Features âœ…
- âœ… CI/CD Pipeline (GitHub Actions)
- âœ… Hotwire/Turbo
- âœ… ViewComponents + Presenters
- âœ… Stimulus Controllers
- âœ… Responsive Design

**Status**: All mandatory requirements completed. Optional enhancements available if time permits.

