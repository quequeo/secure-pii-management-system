# Cursor AI Instructions - Secure PII Management System Challenge

## Project Context

This is a **take-home engineering challenge** for a job application. The goal is to build a secure PII management system with:

- **Rails application** (Ruby on Rails 7.1): Web interface for collecting and displaying PII data
- **Java microservice** (Java 17 + Spring Boot 3.2): SSN validation service per SSA standards

**Working Methodology**: Small, focused PRs - each implementing a single feature with tests.

---

## Critical Requirements to Remember

### SSN Validation Rules (Java Service)
The Java microservice must validate SSN per SSA standards:
- Format: XXX-XX-XXXX (9 digits with dashes)
- Area number (first 3 digits):
  - Cannot be 000 or 666
  - 900-999 IS VALID (used for ITINs)
- Group number (middle 2 digits): Cannot be 00
- Serial number (last 4 digits): Cannot be 0000
- Must reject known invalid test SSNs:
  - 078-05-1120 (Social Security Administration's public example)
  - 219-09-9999 (known invalid)
  - 457-55-5462 (known invalid)

### Security Implementation
- **At Rest**: SSN encrypted in PostgreSQL using Rails encrypted attributes
- **In Transit**: Document HTTPS/TLS (not required for local dev)
- **Display**: SSN masked as `***-**-1234` (only last 4 digits visible)
- **Important**: Masking happens in Rails presentation layer, NOT in Java service
- Java service is internal service-to-service, not exposed to end users

### Architecture
- **Monorepo structure**:
  - `/rails-app` - Rails application
  - `/java-service` - Java Spring Boot microservice
- Services communicate via HTTP REST
- Docker Compose orchestrates all services
- PostgreSQL database

### PII Form Fields
Rails form must collect:
- First Name (required, 1-50 chars)
- Middle Name (required, 1-50 chars)
- Middle Name Override (checkbox for users without middle name)
- Last Name (required, 1-50 chars)
- Social Security Number (required, XXX-XX-XXXX format)
- Address:
  - Street Address 1 (required)
  - Street Address 2 (optional)
  - City (required)
  - State (required, 2-letter abbreviation)
  - ZIP Code (required, 5 digits)

### Testing Requirements
- **Rails**: RSpec with >70% code coverage
  - Model validations
  - Controller/request specs
  - Integration tests for Java service communication
  - Test encryption/decryption
- **Java**: JUnit 5 with >70% code coverage
  - Unit tests for SSN validation logic
  - API endpoint tests

---

## Development Guidelines

### When Writing Code
1. **Test First**: Every feature needs tests
2. **Single Responsibility**: One PR = One feature
3. **Security First**: Always encrypt PII, validate inputs
4. **Documentation**: Update README/ARCHITECTURE.md when needed

### Code Style
- **Rails**: Follow standard Rails conventions, use RSpec for tests
- **Java**: Spring Boot best practices, JUnit 5 for tests
- **Keep it simple**: Functional over beautiful UI
- **No React**: Use Rails views (ERB) with Tailwind CSS

### Testing Strategy
- Write tests BEFORE or ALONGSIDE implementation
- Test both happy paths and error cases
- Integration tests for service-to-service communication
- Mock external service calls when appropriate

### Common Patterns
- Rails calls Java service for SSN validation before saving
- Java service returns validation result (true/false + error message if invalid)
- Rails encrypts SSN before storing in database
- Display layer masks SSN when rendering views

---

## PR/Branch Workflow

### âœ… CHECKLIST for Every PR/Branch

Before completing any PR, ensure you have:

#### 1. **Tests/Specs** (MANDATORY)
- [ ] Written RSpec tests for Rails features (models, controllers, services)
- [ ] Written JUnit tests for Java features
- [ ] Verified tests pass: `bundle exec rspec` or `mvn test`
- [ ] Coverage meets >70% threshold
- [ ] Tests include both happy paths AND error cases

#### 2. **Documentation Updates** (AS NEEDED)
Check if these files need updates:

- [ ] **README.md** - Update if:
  - New feature affects setup/installation
  - New environment variables added
  - New commands or endpoints created
  - Project status/progress changes
  - Implementation status checklist needs updating

- [ ] **ARCHITECTURE.md** - Update if:
  - New service or component added
  - Communication pattern changes
  - Database schema modified
  - Security implementation changes

- [ ] **.cursorrules** - Update if:
  - New patterns or conventions established
  - Project checklist items completed
  - New guidelines or rules needed

- [ ] **CHALLENGE.md** - âš ï¸ Never modify (original requirements)

- [ ] **Code comments** - Add for:
  - Complex business logic
  - Security-critical sections
  - Non-obvious design decisions

#### 3. **Code Quality**
- [ ] No linter errors introduced
- [ ] Follow Rails/Java conventions
- [ ] Secure handling of PII data
- [ ] No hardcoded secrets or credentials

#### 4. **Commit Message**
- [ ] Clear, descriptive message
- [ ] Follows pattern: "Add/Update/Fix [feature/component]"

### ğŸš« Common Mistakes to Avoid

1. **Forgetting tests** - Every PR must have tests
2. **Not updating README** - If feature is user-facing, document it
3. **Incomplete implementation** - Finish what you start in a PR
4. **Multiple features in one PR** - Keep PRs focused and small
5. **Not updating the checklist** - Mark items as complete in `.cursorrules`

---

## Deliverables Checklist

- [ ] Rails app with PII collection form
- [ ] Java microservice with SSN validation
- [ ] PostgreSQL with encrypted SSN storage
- [ ] Display page with masked SSNs
- [ ] Docker Compose setup
- [ ] Tests with >70% coverage (both services)
- [ ] README.md with setup instructions
- [ ] ARCHITECTURE.md with design decisions

---

## Important Notes

- **AI Usage**: Document use of AI tools (this is encouraged!)
- **Assumptions**: Document all assumptions in README.md
- **Quality over Quantity**: Working, well-tested core features > broken complete implementation
- **Time Tracking**: Keep track of time spent for self-assessment

---

## Current Project Status

Check git history for completed PRs. Each PR should be focused and include:
1. Implementation
2. Tests
3. Documentation updates (if needed)

When suggesting new features, consider what's already been implemented in previous PRs.

---

## ğŸ“Š DETAILED PROJECT CHECKLIST

### âœ… COMPLETADO (11 PRs)

#### Infraestructura y Setup
- [x] PR #1 - Initial repository setup (README, .gitignore, folder structure)
- [x] PR #2 - Java Spring Boot project structure (pom.xml, application setup)
- [x] PR #5 - Copilot instructions (documentaciÃ³n para AI)
- [x] PR #9 - Dockerfile for Java service
- [x] PR #10 - Rails 8 application with RSpec setup
- [x] PR #11 - Challenge instructions (README + .cursorrules)

#### Java Microservice - SSN Validation
- [x] PR #3 - SSN validation DTOs (SsnValidationRequest, SsnValidationResponse)
- [x] PR #4 - SSN validation service con reglas SSA
- [x] PR #6 - Unit tests para SSN validation (>70% coverage)
- [x] PR #7 - SSN validation controller (REST endpoint)
- [x] PR #8 - Health check endpoint con tests

**Java Service Status**: âœ… COMPLETO con >70% cobertura de tests

---

### ğŸš§ PENDIENTE - Rails Application & Integration

#### 1. Database & Models (Rails)
- [ ] Configurar PostgreSQL en Rails
- [ ] Crear modelo Person o PiiRecord con campos:
  - first_name, middle_name, last_name
  - ssn (encriptado)
  - street_address_1, street_address_2
  - city, state, zip_code
- [ ] Configurar encriptaciÃ³n de SSN (Rails encrypted attributes o attr_encrypted)
- [ ] Migrations con Ã­ndices y constraints
- [ ] Validaciones del modelo en Rails
- [ ] Tests de modelo (RSpec)

#### 2. PII Collection Form (Rails Views)
- [ ] Controller para PII (PeopleController o similar)
- [ ] Vista new.html.erb con formulario que incluya:
  - First Name, Middle Name, Last Name
  - Middle Name Override (checkbox)
  - SSN (formato XXX-XX-XXXX)
  - Address fields (street 1, street 2, city, state, ZIP)
- [ ] Styling con Tailwind CSS
- [ ] Validaciones client-side bÃ¡sicas
- [ ] Tests de controller (RSpec request specs)

#### 3. Integration Rails â†” Java
- [ ] Servicio HTTP client en Rails para llamar al Java service
- [ ] IntegraciÃ³n en el controller: validar SSN antes de guardar
- [ ] Manejo de errores cuando Java service no responde
- [ ] Tests de integraciÃ³n (mock Java service responses)
- [ ] Variable de entorno para URL del Java service

#### 4. Display Page (Rails Views)
- [ ] Vista index.html.erb con tabla de registros
- [ ] Vista show.html.erb para ver un registro individual
- [ ] Masking de SSN en helpers/presenters (***-**-1234)
- [ ] Routing completo (routes.rb)
- [ ] Tests de vistas (RSpec view specs o feature specs)

#### 5. Docker Compose & Infrastructure
- [ ] docker-compose.yml con:
  - PostgreSQL service
  - Java service
  - Rails service
  - Network configuration
- [ ] Health checks en docker-compose
- [ ] .env.example con variables de entorno necesarias
- [ ] VolÃºmenes para persistencia de datos

#### 6. Documentation
- [ ] ARCHITECTURE.md con:
  - Diagrama de arquitectura (ASCII art)
  - Flujo de comunicaciÃ³n Rails â†” Java
  - Schema de base de datos
  - Decisiones de diseÃ±o de seguridad
- [ ] Actualizar README.md con:
  - Quick start con Docker Compose
  - Instrucciones de setup local
  - CÃ³mo correr tests
  - Variables de entorno
  - Assumptions y trade-offs
  - Time tracking

#### 7. Testing & Coverage
- [ ] Verificar >70% coverage en Rails (SimpleCov)
- [ ] Tests de encriptaciÃ³n/desencriptaciÃ³n
- [ ] Tests de masking de SSN
- [ ] Tests end-to-end (opcional con Capybara)

---

### ğŸ¯ OPCIONAL - Bonus Features (si hay tiempo)

- [ ] Edit/Delete functionality para registros
- [ ] Input sanitization avanzado
- [ ] Audit logging para acceso a PII
- [ ] API rate limiting en Java service
- [ ] CI/CD pipeline (GitHub Actions)
- [ ] Hotwire/Turbo para UI updates

---

## ğŸ“ˆ Progreso General

**Completado**: ~40%
- âœ… Java microservice completo (100%)
- âœ… Rails setup (10%)
- ğŸš§ Rails features (0%)
- ğŸš§ Integration (0%)
- ğŸš§ Docker Compose (0%)
- ğŸš§ Documentation (20%)

**Siguiente paso recomendado**: Empezar con la configuraciÃ³n de PostgreSQL y el modelo de datos en Rails.

